[General]
DeactivateToken = UPDATE tokens SET expiration_date = current_date WHERE value = %%s
UserId = SELECT id FROM users WHERE login = %%s

[Auth]
Register = INSERT INTO users (login, password, email, username, registration_date) VALUES (%%s, %%s, %%s, %%s, current_date) RETURNING id
AssignActivationToken = INSERT INTO tokens (user_id, token_category_id, expiration_date, value) VALUES (%%s, 1, current_date + interval '1 week', %%s)
ValidateUser = SELECT EXISTS (SELECT * FROM users WHERE login = %%s AND password ILIKE %%s)
ActivateAccount = UPDATE users SET is_activated = TRUE WHERE id IN (SELECT user_id FROM tokens WHERE value ilike %%s AND token_category_id = 1 and current_date < expiration_date) RETURNING login

[User]
Info = SELECT email, username, registration_date FROM users WHERE login = %%s
Update = UPDATE users set password = %%s, email = %%s, username = %%s WHERE login = %%s
Delete = DELETE FROM users WHERE login = %%s

[Subaccount]
List = SELECT id, name, code, description FROM subaccounts JOIN currencies c on c.id = currency_id WHERE user_id = %%s
New = INSERT INTO subaccounts (user_id, name) VALUES (%%s, %%s)
Update = UPDATE subaccounts SET name = %%s WHERE id = %%s AND user_id = %%s RETURNING id
Delete = DELETE FROM subaccounts WHERE id = %%s AND user_id = %%s RETURNING id

[Category]
List = SELECT id, name FROM categories WHERE user_id = %%s
New = INSERT INTO categories (user_id, name) VALUES (%%s, %%s)
Update = UPDATE categories SET name = %%s WHERE id = %%s AND user_id = %%s RETURNING id
Delete = DELETE FROM categories WHERE id = %%s AND user_id = %%s RETURNING id

[Transaction]
List = SELECT e.id, date, amount, comment, c.name, s.name FROM entries e JOIN subaccounts s ON s.id = e.subaccount_id JOIN categories c ON c.id = e.category_id JOIN currencies cu ON cu.id = e.currency_id WHERE e.user_id = %%s
New = INSERT INTO entries (user_id, category_id, subaccount_id, currency_id, date, amount, comment) VALUES (%%s, %%s, %%s, %%s, %%s, %%s, %%s)
Authorize = SELECT EXISTS (SELECT * FROM users u JOIN subaccounts s ON u.id = s.user_id JOIN categories c ON u.id = c.user_id WHERE u.id = %%s AND s.id = %%s AND c.id = %%s)
Update = UPDATE entries SET category_id = %%s, subaccount_id = %%s, currency_id = %%s, date = %%s, amount = %%s, comment = %%s WHERE id = %%s AND user_id = %%s RETURNING id
Delete = DELETE FROM entries WHERE id = %%s AND user_id = %%s RETURNING id

[Currency]
List = SELECT id, fullname, code FROM public.currencies

[CSV]
List = SELECT id, name FROM public.csv_formats
Info = SELECT title_index, date_index, amount_index, starting_row, separator FROM public.csv_formats WHERE id = %%s


